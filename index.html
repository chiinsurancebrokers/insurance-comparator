<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insurance Policy Comparator | Î£Ï…Î³ÎºÏÎ¹Ï„Î¹ÎºÏŒ Î‘ÏƒÏ†Î±Î»Î¹ÏƒÏ„Î¹ÎºÏÎ½</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;
        
        const Shield = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </svg>
        );
        
        const Upload = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
        );
        
        const CheckCircle = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
        );
        
        const AlertCircle = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
        );
        
        const TrendingUp = () => (
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
        );

        function InsurancePolicyComparator() {
            const [userInfo, setUserInfo] = useState({
                firstName: '',
                lastName: '',
                dateOfBirth: '',
                nationality: '',
                citizenship: ''
            });
            
            const [policies, setPolicies] = useState([]);
            const [recommendation, setRecommendation] = useState(null);
            const [step, setStep] = useState(1);
            const [language, setLanguage] = useState('en');
            
            const translations = {
                en: {
                    title: "Insurance Policy Comparator",
                    step1Title: "Personal Information",
                    step1Subtitle: "Help us personalize your insurance recommendations",
                    firstName: "First Name",
                    lastName: "Last Name",
                    dateOfBirth: "Date of Birth",
                    nationality: "Nationality",
                    citizenship: "Citizenship",
                    continue: "Continue to Upload Policies",
                    back: "Back",
                    step2Title: "Upload Policy Data",
                    step2Subtitle: "Upload CSV or JSON files with your insurance policies",
                    chooseFile: "Choose File",
                    acceptedFormats: "Accepted formats: CSV, JSON",
                    policiesLoaded: "policies loaded successfully",
                    analyzePolicies: "Analyze Policies",
                    recommendationFor: "Recommendation for",
                    age: "Age",
                    score: "Score",
                    annualPremium: "Annual Premium",
                    excessDeductible: "Excess/Deductible",
                    whyThisPolicy: "Why This Policy?",
                    detailedAnalysis: "Detailed Analysis",
                    benefitsIncluded: "Benefits Included",
                    exclusionsTitle: "Exclusions",
                    otherOptions: "Other Options Considered",
                    startNew: "Start New Comparison",
                    errorReading: "Error reading file. Please ensure it is a valid JSON or CSV file.",
                    completeInfo: "Please complete your information and upload policy data.",
                    clearAll: "Clear All Policies",
                    uploadAnother: "Upload Another File",
                    savings: "Annual Savings",
                    compared: "compared to",
                    keyAdvantages: "Key Advantages",
                    whenToConsider: "When to Consider Alternatives"
                },
                gr: {
                    title: "Î£Ï…Î³ÎºÏÎ¹Ï„Î¹ÎºÏŒ Î‘ÏƒÏ†Î±Î»Î¹ÏƒÏ„Î¹ÎºÏÎ½ Î Î¿Î»Î¹Ï„Î¹ÎºÏÎ½",
                    step1Title: "Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ¬ Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î±",
                    step1Subtitle: "Î’Î¿Î·Î¸Î®ÏƒÏ„Îµ Î¼Î±Ï‚ Î½Î± ÎµÎ¾Î±Ï„Î¿Î¼Î¹ÎºÎµÏÏƒÎ¿Ï…Î¼Îµ Ï„Î¹Ï‚ Î±ÏƒÏ†Î±Î»Î¹ÏƒÏ„Î¹ÎºÎ­Ï‚ ÏƒÎ±Ï‚ ÏƒÏ…ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚",
                    firstName: "ÎŒÎ½Î¿Î¼Î±",
                    lastName: "Î•Ï€ÏÎ½Ï…Î¼Î¿",
                    dateOfBirth: "Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î“Î­Î½Î½Î·ÏƒÎ·Ï‚",
                    nationality: "Î•Î¸Î½Î¹ÎºÏŒÏ„Î·Ï„Î±",
                    citizenship: "Î¥Ï€Î·ÎºÎ¿ÏŒÏ„Î·Ï„Î±",
                    continue: "Î£Ï…Î½Î­Ï‡ÎµÎ¹Î± ÏƒÏ„Î· ÎœÎµÏ„Î±Ï†ÏŒÏÏ„Ï‰ÏƒÎ· Î Î¿Î»Î¹Ï„Î¹ÎºÏÎ½",
                    back: "Î Î¯ÏƒÏ‰",
                    step2Title: "ÎœÎµÏ„Î±Ï†ÏŒÏÏ„Ï‰ÏƒÎ· Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚",
                    step2Subtitle: "ÎœÎµÏ„Î±Ï†Î¿ÏÏ„ÏÏƒÏ„Îµ Î±ÏÏ‡ÎµÎ¯Î± CSV Î® JSON Î¼Îµ Ï„Î¹Ï‚ Î±ÏƒÏ†Î±Î»Î¹ÏƒÏ„Î¹ÎºÎ­Ï‚ ÏƒÎ±Ï‚ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚",
                    chooseFile: "Î•Ï€Î¹Î»Î¿Î³Î® Î‘ÏÏ‡ÎµÎ¯Î¿Ï…",
                    acceptedFormats: "Î‘Ï€Î¿Î´ÎµÎºÏ„Î­Ï‚ Î¼Î¿ÏÏ†Î­Ï‚: CSV, JSON",
                    policiesLoaded: "Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚ Ï†Î¿ÏÏ„ÏÎ¸Î·ÎºÎ±Î½ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚",
                    analyzePolicies: "Î‘Î½Î¬Î»Ï…ÏƒÎ· Î Î¿Î»Î¹Ï„Î¹ÎºÏÎ½",
                    recommendationFor: "Î£ÏÏƒÏ„Î±ÏƒÎ· Î³Î¹Î±",
                    age: "Î—Î»Î¹ÎºÎ¯Î±",
                    score: "Î’Î±Î¸Î¼Î¿Î»Î¿Î³Î¯Î±",
                    annualPremium: "Î•Ï„Î®ÏƒÎ¹Î¿ Î‘ÏƒÏ†Î¬Î»Î¹ÏƒÏ„ÏÎ¿",
                    excessDeductible: "Î‘Ï€Î±Î»Î»Î±Î³Î®",
                    whyThisPolicy: "Î“Î¹Î±Ï„Î¯ Î‘Ï…Ï„Î® Î· Î Î¿Î»Î¹Ï„Î¹ÎºÎ®;",
                    detailedAnalysis: "Î›ÎµÏ€Ï„Î¿Î¼ÎµÏÎ®Ï‚ Î‘Î½Î¬Î»Ï…ÏƒÎ·",
                    benefitsIncluded: "Î Î±ÏÎ¿Ï‡Î­Ï‚ Ï€Î¿Ï… Î ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½Î¿Î½Ï„Î±Î¹",
                    exclusionsTitle: "Î•Î¾Î±Î¹ÏÎ­ÏƒÎµÎ¹Ï‚",
                    otherOptions: "Î†Î»Î»ÎµÏ‚ Î•Ï€Î¹Î»Î¿Î³Î­Ï‚ Ï€Î¿Ï… Î•Î¾ÎµÏ„Î¬ÏƒÏ„Î·ÎºÎ±Î½",
                    startNew: "ÎˆÎ½Î±ÏÎ¾Î· ÎÎ­Î±Ï‚ Î£ÏÎ³ÎºÏÎ¹ÏƒÎ·Ï‚",
                    errorReading: "Î£Ï†Î¬Î»Î¼Î± Î±Î½Î¬Î³Î½Ï‰ÏƒÎ·Ï‚ Î±ÏÏ‡ÎµÎ¯Î¿Ï…. Î’ÎµÎ²Î±Î¹Ï‰Î¸ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ ÎµÎ¯Î½Î±Î¹ Î­Î³ÎºÏ…ÏÎ¿ Î±ÏÏ‡ÎµÎ¯Î¿ JSON Î® CSV.",
                    completeInfo: "Î Î±ÏÎ±ÎºÎ±Î»Ï ÏƒÏ…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± ÏƒÎ±Ï‚ ÎºÎ±Î¹ Î¼ÎµÏ„Î±Ï†Î¿ÏÏ„ÏÏƒÏ„Îµ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚.",
                    clearAll: "Î•ÎºÎºÎ±Î¸Î¬ÏÎ¹ÏƒÎ· ÎŒÎ»Ï‰Î½ Ï„Ï‰Î½ Î Î¿Î»Î¹Ï„Î¹ÎºÏÎ½",
                    uploadAnother: "ÎœÎµÏ„Î±Ï†ÏŒÏÏ„Ï‰ÏƒÎ· Î†Î»Î»Î¿Ï… Î‘ÏÏ‡ÎµÎ¯Î¿Ï…",
                    savings: "Î•Ï„Î®ÏƒÎ¹Î± Î•Î¾Î¿Î¹ÎºÎ¿Î½ÏŒÎ¼Î·ÏƒÎ·",
                    compared: "ÏƒÎµ ÏƒÏÎ³ÎºÏÎ¹ÏƒÎ· Î¼Îµ",
                    keyAdvantages: "Î’Î±ÏƒÎ¹ÎºÎ¬ Î Î»ÎµÎ¿Î½ÎµÎºÏ„Î®Î¼Î±Ï„Î±",
                    whenToConsider: "Î ÏŒÏ„Îµ Î½Î± Î•Î¾ÎµÏ„Î¬ÏƒÎµÏ„Îµ Î•Î½Î±Î»Î»Î±ÎºÏ„Î¹ÎºÎ­Ï‚"
                }
            };
            
            const t = translations[language];
            
            const calculateAge = (dob) => {
                const today = new Date();
                const birthDate = new Date(dob);
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                return age;
            };
            
            const handleFileUpload = async (event) => {
                const file = event.target.files[0];
                if (!file) return;

                try {
                    const text = await file.text();
                    let parsedPolicies;

                    if (file.name.endsWith('.json')) {
                        parsedPolicies = JSON.parse(text);
                    } else if (file.name.endsWith('.csv')) {
                        const result = Papa.parse(text, { 
                            header: true, 
                            dynamicTyping: true, 
                            skipEmptyLines: true
                        });
                        parsedPolicies = result.data;
                    }

                    setPolicies(prev => {
                        const newPolicies = Array.isArray(parsedPolicies) ? parsedPolicies : [parsedPolicies];
                        return [...prev, ...newPolicies];
                    });
                } catch (error) {
                    alert(t.errorReading);
                }
            };
            
            const getDetailedReasoning = (policy, allPolicies, age) => {
                const reasons = [];
                
                // Premium comparison
                const avgPremium = allPolicies.reduce((sum, p) => sum + p.premium, 0) / allPolicies.length;
                const premiumDiff = ((avgPremium - policy.premium) / avgPremium * 100).toFixed(0);
                
                if (policy.premium < avgPremium) {
                    reasons.push({
                        type: 'positive',
                        title: language === 'en' ? 'ğŸ’° Most Affordable Premium' : 'ğŸ’° Î Î¹Î¿ Î ÏÎ¿ÏƒÎ¹Ï„ÏŒ Î‘ÏƒÏ†Î¬Î»Î¹ÏƒÏ„ÏÎ¿',
                        detail: language === 'en' 
                            ? `At â‚¬${policy.premium}/year, this policy is ${premiumDiff}% cheaper than the average (â‚¬${avgPremium.toFixed(0)}). You save significantly on annual costs while maintaining comprehensive coverage.`
                            : `Î£Ï„Î± â‚¬${policy.premium}/Î­Ï„Î¿Ï‚, Î±Ï…Ï„Î® Î· Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® ÎµÎ¯Î½Î±Î¹ ${premiumDiff}% Ï†Î¸Î·Î½ÏŒÏ„ÎµÏÎ· Î±Ï€ÏŒ Ï„Î¿ Î¼Î­ÏƒÎ¿ ÏŒÏÎ¿ (â‚¬${avgPremium.toFixed(0)}). Î•Î¾Î¿Î¹ÎºÎ¿Î½Î¿Î¼ÎµÎ¯Ï„Îµ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÎ¬ ÏƒÏ„Î¿ ÎµÏ„Î®ÏƒÎ¹Î¿ ÎºÏŒÏƒÏ„Î¿Ï‚ Î´Î¹Î±Ï„Î·ÏÏÎ½Ï„Î±Ï‚ Î¿Î»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½Î· ÎºÎ¬Î»Ï…ÏˆÎ·.`
                    });
                }
                
                // Excess comparison
                const avgExcess = allPolicies.reduce((sum, p) => sum + p.excess, 0) / allPolicies.length;
                if (policy.excess < avgExcess) {
                    const excessDiff = avgExcess - policy.excess;
                    reasons.push({
                        type: 'positive',
                        title: language === 'en' ? 'ğŸ’³ Lowest Out-of-Pocket Costs' : 'ğŸ’³ Î§Î±Î¼Î·Î»ÏŒÏ„ÎµÏÎ± ÎˆÎ¾Î¿Î´Î± Î±Ï€ÏŒ Ï„Î·Î½ Î¤ÏƒÎ­Ï€Î·',
                        detail: language === 'en'
                            ? `With only â‚¬${policy.excess} excess, you pay â‚¬${excessDiff.toFixed(0)} less per claim compared to the average (â‚¬${avgExcess.toFixed(0)}). This means lower immediate costs when you need medical care.`
                            : `ÎœÎµ Î¼ÏŒÎ½Î¿ â‚¬${policy.excess} Î±Ï€Î±Î»Î»Î±Î³Î®, Ï€Î»Î·ÏÏÎ½ÎµÏ„Îµ â‚¬${excessDiff.toFixed(0)} Î»Î¹Î³ÏŒÏ„ÎµÏÎ± Î±Î½Î¬ Î±Î¾Î¯Ï‰ÏƒÎ· ÏƒÎµ ÏƒÏÎ³ÎºÏÎ¹ÏƒÎ· Î¼Îµ Ï„Î¿ Î¼Î­ÏƒÎ¿ ÏŒÏÎ¿ (â‚¬${avgExcess.toFixed(0)}). Î‘Ï…Ï„ÏŒ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ Ï‡Î±Î¼Î·Î»ÏŒÏ„ÎµÏÎ± Î¬Î¼ÎµÏƒÎ± Î­Î¾Î¿Î´Î± ÏŒÏ„Î±Î½ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏƒÏ„Îµ Î¹Î±Ï„ÏÎ¹ÎºÎ® Ï†ÏÎ¿Î½Ï„Î¯Î´Î±.`
                    });
                }
                
                // Benefits analysis
                const benefitCount = policy.benefits ? (Array.isArray(policy.benefits) ? policy.benefits.length : String(policy.benefits).split(',').length) : 0;
                if (benefitCount > 15) {
                    reasons.push({
                        type: 'positive',
                        title: language === 'en' ? 'ğŸ¥ Comprehensive Coverage' : 'ğŸ¥ ÎŸÎ»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½Î· ÎšÎ¬Î»Ï…ÏˆÎ·',
                        detail: language === 'en'
                            ? `Includes ${benefitCount} different benefits covering hospital care, emergency services, maternity, dental emergencies, and 24/7 support. This extensive coverage ensures you're protected in various medical situations.`
                            : `Î ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ ${benefitCount} Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ­Ï‚ Ï€Î±ÏÎ¿Ï‡Î­Ï‚ Ï€Î¿Ï… ÎºÎ±Î»ÏÏ€Ï„Î¿Ï…Î½ Î½Î¿ÏƒÎ¿ÎºÎ¿Î¼ÎµÎ¹Î±ÎºÎ® Ï†ÏÎ¿Î½Ï„Î¯Î´Î±, ÎµÏ€ÎµÎ¯Î³Î¿Î½Ï„Î± Ï€ÎµÏÎ¹ÏƒÏ„Î±Ï„Î¹ÎºÎ¬, Î¼Î·Ï„ÏÏŒÏ„Î·Ï„Î±, Î¿Î´Î¿Î½Ï„Î¹Î±Ï„ÏÎ¹ÎºÎ¬ ÎµÏ€ÎµÎ¯Î³Î¿Î½Ï„Î± ÎºÎ±Î¹ Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· 24/7. Î‘Ï…Ï„Î® Î· ÎµÎºÏ„ÎµÏ„Î±Î¼Î­Î½Î· ÎºÎ¬Î»Ï…ÏˆÎ· Î´Î¹Î±ÏƒÏ†Î±Î»Î¯Î¶ÎµÎ¹ ÏŒÏ„Î¹ ÎµÎ¯ÏƒÏ„Îµ Ï€ÏÎ¿ÏƒÏ„Î±Ï„ÎµÏ…Î¼Î­Î½Î¿Î¹ ÏƒÎµ Î´Î¹Î¬Ï†Î¿ÏÎµÏ‚ Î¹Î±Ï„ÏÎ¹ÎºÎ­Ï‚ ÎºÎ±Ï„Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚.`
                    });
                }
                
                // Age-specific benefits
                if (age > 45 && policy.benefits && String(policy.benefits).toLowerCase().includes('chronic')) {
                    reasons.push({
                        type: 'positive',
                        title: language === 'en' ? 'ğŸ‘¤ Perfect for Your Age Group' : 'ğŸ‘¤ Î™Î´Î±Î½Î¹ÎºÏŒ Î³Î¹Î± Ï„Î·Î½ Î—Î»Î¹ÎºÎ¹Î±ÎºÎ® ÏƒÎ±Ï‚ ÎŸÎ¼Î¬Î´Î±',
                        detail: language === 'en'
                            ? `At age ${age}, you benefit from chronic condition coverage, which becomes increasingly important. This policy provides appropriate protection for age-related health needs.`
                            : `Î£Îµ Î·Î»Î¹ÎºÎ¯Î± ${age}, ÎµÏ€Ï‰Ï†ÎµÎ»ÎµÎ¯ÏƒÏ„Îµ Î±Ï€ÏŒ Ï„Î·Î½ ÎºÎ¬Î»Ï…ÏˆÎ· Ï‡ÏÏŒÎ½Î¹Ï‰Î½ Ï€Î±Î¸Î®ÏƒÎµÏ‰Î½, Ï€Î¿Ï… Î³Î¯Î½ÎµÏ„Î±Î¹ ÏŒÎ»Î¿ ÎºÎ±Î¹ Ï€Î¹Î¿ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÎ®. Î‘Ï…Ï„Î® Î· Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® Ï€Î±ÏÎ­Ï‡ÎµÎ¹ ÎºÎ±Ï„Î¬Î»Î»Î·Î»Î· Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î± Î³Î¹Î± Ï„Î¹Ï‚ Î·Î»Î¹ÎºÎ¹Î±ÎºÎ­Ï‚ Ï…Î³ÎµÎ¹Î¿Î½Î¿Î¼Î¹ÎºÎ­Ï‚ Î±Î½Î¬Î³ÎºÎµÏ‚.`
                    });
                }
                
                // Geographic coverage
                if (policy.provider && (policy.provider.includes('Greece') || policy.provider.includes('Europe'))) {
                    reasons.push({
                        type: 'positive',
                        title: language === 'en' ? 'ğŸŒ Ideal for Greek Residents' : 'ğŸŒ Î™Î´Î±Î½Î¹ÎºÏŒ Î³Î¹Î± ÎšÎ±Ï„Î¿Î¯ÎºÎ¿Ï…Ï‚ Î•Î»Î»Î¬Î´Î±Ï‚',
                        detail: language === 'en'
                            ? `Strong network in Greece and Europe means easier access to hospitals, lower administrative hassle, and no need to pay for unnecessary worldwide coverage if you don't travel internationally often.`
                            : `Î™ÏƒÏ‡Ï…ÏÏŒ Î´Î¯ÎºÏ„Ï…Î¿ ÏƒÏ„Î·Î½ Î•Î»Î»Î¬Î´Î± ÎºÎ±Î¹ Î•Ï…ÏÏÏ€Î· ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÎµÏ…ÎºÎ¿Î»ÏŒÏ„ÎµÏÎ· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î½Î¿ÏƒÎ¿ÎºÎ¿Î¼ÎµÎ¯Î±, Ï‡Î±Î¼Î·Î»ÏŒÏ„ÎµÏÎ¿ Î´Î¹Î¿Î¹ÎºÎ·Ï„Î¹ÎºÏŒ Ï†ÏŒÏÏ„Î¿ ÎºÎ±Î¹ Î´ÎµÎ½ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Î½Î± Ï€Î»Î·ÏÏÏƒÎµÏ„Îµ Î³Î¹Î± Ï€ÎµÏÎ¹Ï„Ï„Î® Ï€Î±Î³ÎºÏŒÏƒÎ¼Î¹Î± ÎºÎ¬Î»Ï…ÏˆÎ· Î±Î½ Î´ÎµÎ½ Ï„Î±Î¾Î¹Î´ÎµÏÎµÏ„Îµ ÏƒÏ…Ï‡Î½Î¬ Î´Î¹ÎµÎ¸Î½ÏÏ‚.`
                    });
                }
                
                // Value proposition
                const valueScore = (1000 / policy.premium) * (benefitCount / 10) * (1000 / (policy.excess + 1));
                if (valueScore > 50) {
                    reasons.push({
                        type: 'positive',
                        title: language === 'en' ? 'â­ Exceptional Value for Money' : 'â­ Î•Î¾Î±Î¹ÏÎµÏ„Î¹ÎºÎ® Î£Ï‡Î­ÏƒÎ· Î Î¿Î¹ÏŒÏ„Î·Ï„Î±Ï‚-Î¤Î¹Î¼Î®Ï‚',
                        detail: language === 'en'
                            ? `When considering the balance of low premium, low excess, and comprehensive benefits, this policy offers outstanding value. You get maximum protection for minimum cost.`
                            : `Î›Î±Î¼Î²Î¬Î½Î¿Î½Ï„Î±Ï‚ Ï…Ï€ÏŒÏˆÎ· Ï„Î·Î½ Î¹ÏƒÎ¿ÏÏÎ¿Ï€Î¯Î± Ï‡Î±Î¼Î·Î»Î¿Ï Î±ÏƒÏ†Î±Î»Î¯ÏƒÏ„ÏÎ¿Ï…, Ï‡Î±Î¼Î·Î»Î®Ï‚ Î±Ï€Î±Î»Î»Î±Î³Î®Ï‚ ÎºÎ±Î¹ Î¿Î»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½Ï‰Î½ Ï€Î±ÏÎ¿Ï‡ÏÎ½, Î±Ï…Ï„Î® Î· Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® Ï€ÏÎ¿ÏƒÏ†Î­ÏÎµÎ¹ ÎµÎ¾Î±Î¹ÏÎµÏ„Î¹ÎºÎ® Î±Î¾Î¯Î±. Î›Î±Î¼Î²Î¬Î½ÎµÏ„Îµ Î¼Î­Î³Î¹ÏƒÏ„Î· Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î± Î¼Îµ ÎµÎ»Î¬Ï‡Î¹ÏƒÏ„Î¿ ÎºÏŒÏƒÏ„Î¿Ï‚.`
                    });
                }
                
                return reasons;
            };
            
            const analyzePolicies = () => {
                if (!userInfo.dateOfBirth || policies.length === 0) {
                    alert(t.completeInfo);
                    return;
                }

                const age = calculateAge(userInfo.dateOfBirth);
                
                const scoredPolicies = policies.map(policy => {
                    let score = 0;
                    let reasoning = [];

                    const premiumScore = policy.premium ? Math.max(0, 100 - (policy.premium / 50)) : 50;
                    score += premiumScore * 0.35;

                    const excessScore = policy.excess ? Math.max(0, 100 - (policy.excess / 20)) : 50;
                    score += excessScore * 0.20;

                    const benefitCount = policy.benefits ? (Array.isArray(policy.benefits) ? policy.benefits.length : String(policy.benefits).split(',').length) : 0;
                    const benefitScore = Math.min(100, benefitCount * 10);
                    score += benefitScore * 0.30;

                    const exclusionCount = policy.exclusions ? (Array.isArray(policy.exclusions) ? policy.exclusions.length : String(policy.exclusions).split(',').length) : 0;
                    const exclusionScore = Math.max(0, 100 - (exclusionCount * 15));
                    score += exclusionScore * 0.15;

                    return {
                        ...policy,
                        totalScore: Math.round(score * 10) / 10,
                        reasoning,
                        benefitCount,
                        exclusionCount
                    };
                });

                scoredPolicies.sort((a, b) => b.totalScore - a.totalScore);
                
                // Add detailed reasoning to top policy
                scoredPolicies[0].detailedReasons = getDetailedReasoning(scoredPolicies[0], scoredPolicies, age);
                
                setRecommendation(scoredPolicies);
                setStep(3);
            };
            
            const renderStep1 = () => (
                <div className="space-y-6">
                    <div className="text-center mb-8">
                        <div className="w-16 h-16 text-blue-600 mx-auto mb-4 flex items-center justify-center">
                            <Shield />
                        </div>
                        <h2 className="text-2xl font-bold text-gray-800">{t.step1Title}</h2>
                        <p className="text-gray-600 mt-2">{t.step1Subtitle}</p>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">{t.firstName}</label>
                            <input
                                type="text"
                                value={userInfo.firstName}
                                onChange={(e) => setUserInfo(prev => ({ ...prev, firstName: e.target.value }))}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder={language === 'en' ? 'John' : 'Î“Î¹Î¬Î½Î½Î·Ï‚'}
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">{t.lastName}</label>
                            <input
                                type="text"
                                value={userInfo.lastName}
                                onChange={(e) => setUserInfo(prev => ({ ...prev, lastName: e.target.value }))}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder={language === 'en' ? 'Doe' : 'Î Î±Ï€Î±Î´ÏŒÏ€Î¿Ï…Î»Î¿Ï‚'}
                            />
                        </div>
                    </div>

                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">{t.dateOfBirth}</label>
                        <input
                            type="date"
                            value={userInfo.dateOfBirth}
                            onChange={(e) => setUserInfo(prev => ({ ...prev, dateOfBirth: e.target.value }))}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        />
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">{t.nationality}</label>
                            <input
                                type="text"
                                value={userInfo.nationality}
                                onChange={(e) => setUserInfo(prev => ({ ...prev, nationality: e.target.value }))}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder={language === 'en' ? 'American' : 'Î•Î»Î»Î·Î½Î¹ÎºÎ®'}
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">{t.citizenship}</label>
                            <input
                                type="text"
                                value={userInfo.citizenship}
                                onChange={(e) => setUserInfo(prev => ({ ...prev, citizenship: e.target.value }))}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder={language === 'en' ? 'United States' : 'Î•Î»Î»Î¬Î´Î±'}
                            />
                        </div>
                    </div>

                    <button
                        onClick={() => setStep(2)}
                        disabled={!userInfo.firstName || !userInfo.lastName || !userInfo.dateOfBirth}
                        className="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition"
                    >
                        {t.continue}
                    </button>
                </div>
            );
            
            const renderStep2 = () => (
                <div className="space-y-6">
                    <div className="text-center mb-8">
                        <div className="w-16 h-16 text-blue-600 mx-auto mb-4 flex items-center justify-center">
                            <Upload />
                        </div>
                        <h2 className="text-2xl font-bold text-gray-800">{t.step2Title}</h2>
                        <p className="text-gray-600 mt-2">{t.step2Subtitle}</p>
                    </div>

                    <div className="bg-blue-50 border-2 border-blue-200 border-dashed rounded-lg p-8 text-center">
                        <label className="cursor-pointer">
                            <span className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 inline-block">
                                {t.chooseFile}
                            </span>
                            <input
                                type="file"
                                accept=".csv,.json"
                                onChange={handleFileUpload}
                                className="hidden"
                            />
                        </label>
                        <p className="text-sm text-gray-600 mt-4">{t.acceptedFormats}</p>
                        <p className="text-xs text-gray-500 mt-2">{language === 'en' ? 'PDF support requires backend server' : 'Î— Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· PDF Î±Ï€Î±Î¹Ï„ÎµÎ¯ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® backend'}</p>
                    </div>

                    {policies.length > 0 && (
                        <div className="space-y-3">
                            <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center gap-2">
                                        <CheckCircle />
                                        <span className="text-green-800 font-medium">{policies.length} {t.policiesLoaded}</span>
                                    </div>
                                    <button
                                        onClick={() => setPolicies([])}
                                        className="text-sm text-red-600 hover:text-red-700 font-medium"
                                    >
                                        {t.clearAll}
                                    </button>
                                </div>
                            </div>
                            <div className="bg-blue-50 border border-blue-200 rounded-lg p-3 text-center">
                                <p className="text-sm text-blue-700">{t.uploadAnother}</p>
                            </div>
                        </div>
                    )}

                    <div className="flex gap-4">
                        <button
                            onClick={() => setStep(1)}
                            className="flex-1 bg-gray-200 text-gray-800 py-3 rounded-lg font-semibold hover:bg-gray-300 transition"
                        >
                            {t.back}
                        </button>
                        <button
                            onClick={analyzePolicies}
                            disabled={policies.length === 0}
                            className="flex-1 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition"
                        >
                            {t.analyzePolicies}
                        </button>
                    </div>
                </div>
            );
            
            const renderStep3 = () => {
                if (!recommendation || recommendation.length === 0) return null;

                const bestPolicy = recommendation[0];
                const age = calculateAge(userInfo.dateOfBirth);
                
                // Calculate savings
                const otherPolicies = recommendation.slice(1);
                const avgOtherPremium = otherPolicies.length > 0 
                    ? otherPolicies.reduce((sum, p) => sum + p.premium, 0) / otherPolicies.length 
                    : 0;
                const savings = avgOtherPremium - bestPolicy.premium;

                return (
                    <div className="space-y-6">
                        <div className="bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg p-6">
                            <div className="flex items-center gap-3 mb-2">
                                <TrendingUp />
                                <div>
                                    <h2 className="text-2xl font-bold">{t.recommendationFor} {userInfo.firstName} {userInfo.lastName}</h2>
                                    <p className="text-blue-100">{t.age}: {age} | {userInfo.nationality}</p>
                                </div>
                            </div>
                        </div>

                        <div className="bg-green-50 border-2 border-green-500 rounded-lg p-6">
                            <div className="flex items-center justify-between mb-4">
                                <h3 className="text-2xl font-bold text-gray-800">{bestPolicy.policyName}</h3>
                                <span className="bg-green-500 text-white px-4 py-2 rounded-full font-bold">
                                    {t.score}: {bestPolicy.totalScore}/100
                                </span>
                            </div>
                            <p className="text-lg text-gray-700 mb-4">{bestPolicy.provider}</p>
                            
                            <div className="grid grid-cols-2 gap-4 mb-6">
                                <div className="bg-white rounded-lg p-4 border-2 border-green-300">
                                    <p className="text-sm text-gray-600">{t.annualPremium}</p>
                                    <p className="text-3xl font-bold text-green-600">â‚¬{bestPolicy.premium}</p>
                                    <p className="text-xs text-gray-500 mt-1">â‚¬{(bestPolicy.premium/12).toFixed(2)}/month</p>
                                </div>
                                <div className="bg-white rounded-lg p-4 border-2 border-blue-300">
                                    <p className="text-sm text-gray-600">{t.excessDeductible}</p>
                                    <p className="text-3xl font-bold text-blue-600">â‚¬{bestPolicy.excess}</p>
                                    <p className="text-xs text-green-600 mt-1">âœ“ {language === 'en' ? 'Lowest excess' : 'Î§Î±Î¼Î·Î»ÏŒÏ„ÎµÏÎ· Î±Ï€Î±Î»Î»Î±Î³Î®'}</p>
                                </div>
                            </div>

                            {savings > 0 && (
                                <div className="bg-yellow-50 border-2 border-yellow-400 rounded-lg p-4 mb-6">
                                    <div className="flex items-center gap-2 mb-2">
                                        <span className="text-2xl">ğŸ’°</span>
                                        <h4 className="font-bold text-yellow-900 text-lg">{t.savings}</h4>
                                    </div>
                                    <p className="text-yellow-900">
                                        <span className="text-3xl font-bold">â‚¬{savings.toFixed(0)}</span>
                                        <span className="text-sm ml-2">{t.compared} {language === 'en' ? 'other options' : 'Î¬Î»Î»ÎµÏ‚ ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚'}</span>
                                    </p>
                                    <p className="text-sm text-yellow-800 mt-1">
                                        {language === 'en' 
                                            ? `That's â‚¬${(savings/12).toFixed(2)} saved every month!` 
                                            : `Î‘Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ â‚¬${(savings/12).toFixed(2)} ÎµÎ¾Î¿Î¹ÎºÎ¿Î½ÏŒÎ¼Î·ÏƒÎ· ÎºÎ¬Î¸Îµ Î¼Î®Î½Î±!`}
                                    </p>
                                </div>
                            )}

                            {bestPolicy.detailedReasons && bestPolicy.detailedReasons.length > 0 && (
                                <div className="bg-white rounded-lg p-6 mb-6 border-2 border-green-200">
                                    <h4 className="font-bold text-gray-900 text-xl mb-4 flex items-center gap-2">
                                        <span>ğŸ¯</span> {t.detailedAnalysis}
                                    </h4>
                                    <div className="space-y-4">
                                        {bestPolicy.detailedReasons.map((reason, idx) => (
                                            <div key={idx} className="border-l-4 border-green-500 pl-4 py-2 bg-green-50 rounded-r">
                                                <h5 className="font-semibold text-gray-900 mb-1">{reason.title}</h5>
                                                <p className="text-sm text-gray-700 leading-relaxed">{reason.detail}</p>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            <div className="grid grid-cols-1 gap-4 mb-4">
                                <div className="bg-white rounded-lg p-4 border border-gray-200">
                                    <h4 className="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                        <CheckCircle />
                                        {t.benefitsIncluded} ({bestPolicy.benefitCount})
                                    </h4>
                                    <p className="text-sm text-gray-600 leading-relaxed">
                                        {Array.isArray(bestPolicy.benefits) 
                                            ? bestPolicy.benefits.join(', ') 
                                            : bestPolicy.benefits}
                                    </p>
                                </div>
                                <div className="bg-white rounded-lg p-4 border border-gray-200">
                                    <h4 className="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                        <AlertCircle />
                                        {t.exclusionsTitle} ({bestPolicy.exclusionCount})
                                    </h4>
                                    <p className="text-sm text-gray-600 leading-relaxed">
                                        {Array.isArray(bestPolicy.exclusions) 
                                            ? bestPolicy.exclusions.join(', ') 
                                            : bestPolicy.exclusions}
                                    </p>
                                </div>
                            </div>

                            {recommendation.length > 1 && (
                                <div className="bg-gray-50 rounded-lg p-4 border border-gray-300">
                                    <h4 className="font-semibold text-gray-800 mb-2">âš ï¸ {t.whenToConsider}:</h4>
                                    <ul className="text-sm text-gray-700 space-y-1 ml-4">
                                        <li>â€¢ {language === 'en' 
                                            ? 'Need frequent international travel outside Europe' 
                                            : 'Î§ÏÎµÎ¹Î¬Î¶ÎµÏƒÏ„Îµ ÏƒÏ…Ï‡Î½Î¬ Î´Î¹ÎµÎ¸Î½Î® Ï„Î±Î¾Î¯Î´Î¹Î± ÎµÎºÏ„ÏŒÏ‚ Î•Ï…ÏÏÏ€Î·Ï‚'}</li>
                                        <li>â€¢ {language === 'en' 
                                            ? 'Require unlimited outpatient visits' 
                                            : 'Î‘Ï€Î±Î¹Ï„ÎµÎ¯Ï„Îµ Î±Ï€ÎµÏÎ¹ÏŒÏÎ¹ÏƒÏ„ÎµÏ‚ ÎµÎ¾Ï‰Î½Î¿ÏƒÎ¿ÎºÎ¿Î¼ÎµÎ¹Î±ÎºÎ­Ï‚ ÎµÏ€Î¹ÏƒÎºÎ­ÏˆÎµÎ¹Ï‚'}</li>
                                        <li>â€¢ {language === 'en' 
                                            ? 'Need very high hospital coverage limits' 
                                            : 'Î§ÏÎµÎ¹Î¬Î¶ÎµÏƒÏ„Îµ Ï€Î¿Î»Ï Ï…ÏˆÎ·Î»Î¬ ÏŒÏÎ¹Î± Î½Î¿ÏƒÎ¿ÎºÎ¿Î¼ÎµÎ¹Î±ÎºÎ®Ï‚ ÎºÎ¬Î»Ï…ÏˆÎ·Ï‚'}</li>
                                    </ul>
                                </div>
                            )}
                        </div>

                        {recommendation.length > 1 && (
                            <div className="space-y-4">
                                <h3 className="text-xl font-bold text-gray-800">{t.otherOptions}</h3>
                                {recommendation.slice(1).map((policy, idx) => (
                                    <div key={idx} className="bg-white border-2 border-gray-200 rounded-lg p-4">
                                        <div className="flex items-center justify-between mb-2">
                                            <h4 className="text-lg font-semibold text-gray-800">{policy.policyName}</h4>
                                            <span className="bg-gray-200 text-gray-700 px-3 py-1 rounded-full font-semibold">
                                                {t.score}: {policy.totalScore}/100
                                            </span>
                                        </div>
                                        <p className="text-gray-600 mb-2">{policy.provider}</p>
                                        <div className="grid grid-cols-2 gap-2 text-sm">
                                            <p><span className="font-medium">{t.annualPremium}:</span> â‚¬{policy.premium}</p>
                                            <p><span className="font-medium">{t.excessDeductible}:</span> â‚¬{policy.excess}</p>
                                        </div>
                                        <div className="mt-2 text-xs text-gray-500">
                                            <span>{bestPolicy.benefitCount} {language === 'en' ? 'benefits' : 'Ï€Î±ÏÎ¿Ï‡Î­Ï‚'}</span>
                                            <span className="mx-2">â€¢</span>
                                            <span>{policy.exclusionCount} {language === 'en' ? 'exclusions' : 'ÎµÎ¾Î±Î¹ÏÎ­ÏƒÎµÎ¹Ï‚'}</span>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        <button
                            onClick={() => {
                                setStep(1);
                                setPolicies([]);
                                setRecommendation(null);
                            }}
                            className="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition"
                        >
                            {t.startNew}
                        </button>
                    </div>
                );
            };
            
            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-xl p-8">
                            <div className="flex justify-between items-start mb-8">
                                <h1 className="text-3xl font-bold text-gray-800">{t.title}</h1>
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => setLanguage('en')}
                                        className={`px-4 py-2 rounded-lg font-semibold transition ${
                                            language === 'en' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'
                                        }`}
                                    >
                                        EN
                                    </button>
                                    <button
                                        onClick={() => setLanguage('gr')}
                                        className={`px-4 py-2 rounded-lg font-semibold transition ${
                                            language === 'gr' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'
                                        }`}
                                    >
                                        Î•Î›
                                    </button>
                                </div>
                            </div>

                            {step === 1 && renderStep1()}
                            {step === 2 && renderStep2()}
                            {step === 3 && renderStep3()}
                        </div>
                        
                        <footer className="text-center mt-8 text-gray-600 text-sm">
                            <p>Â© 2025 Insurance Policy Comparator | {language === 'en' ? 'Made with â¤ï¸ for better decisions' : 'Î¦Ï„Î¹Î±Î³Î¼Î­Î½Î¿ Î¼Îµ â¤ï¸ Î³Î¹Î± ÎºÎ±Î»ÏÏ„ÎµÏÎµÏ‚ Î±Ï€Î¿Ï†Î¬ÏƒÎµÎ¹Ï‚'}</p>
                        </footer>
                    </div>
                </div>
            );
        }
        
        ReactDOM.render(<InsurancePolicyComparator />, document.getElementById('root'));
    </script>
</body>
</html>
