<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Insurance Assistant - Coverage Analyzer</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Icon Components (replacing lucide-react)
        const Shield = () => <i className="fas fa-shield-alt"></i>;
        const Upload = () => <i className="fas fa-upload"></i>;
        const Brain = () => <i className="fas fa-brain"></i>;
        const FileText = () => <i className="fas fa-file-alt"></i>;
        const AlertTriangle = () => <i className="fas fa-exclamation-triangle"></i>;
        const CheckCircle = () => <i className="fas fa-check-circle"></i>;
        const TrendingUp = () => <i className="fas fa-chart-line"></i>;
        const Download = () => <i className="fas fa-download"></i>;
        const Save = () => <i className="fas fa-save"></i>;
        const Trash2 = () => <i className="fas fa-trash"></i>;
        const Plus = () => <i className="fas fa-plus"></i>;
        const Loader = () => <i className="fas fa-spinner fa-spin"></i>;

        const InsuranceAIAssistant = () => {
          const [userInfo, setUserInfo] = useState({
            firstName: '', lastName: '', dateOfBirth: '', nationality: '',
            occupation: '', dependents: 0, healthConditions: ''
          });
          
          const [policies, setPolicies] = useState([]);
          const [activeTab, setActiveTab] = useState('dashboard');
          const [language, setLanguage] = useState('en');
          const [aiAnalysis, setAiAnalysis] = useState(null);
          const [isAnalyzing, setIsAnalyzing] = useState(false);
          const [saveMessage, setSaveMessage] = useState('');
          const [showManualEntry, setShowManualEntry] = useState(false);
          const [newPolicy, setNewPolicy] = useState({
            policyName: '', provider: '', premium: '', excess: '', benefits: '', exclusions: ''
          });

          useEffect(() => {
            try {
              const saved = sessionStorage.getItem('insuranceAIData');
              if (saved) {
                const data = JSON.parse(saved);
                if (data.userInfo) setUserInfo(data.userInfo);
                if (data.policies) setPolicies(data.policies);
                if (data.language) setLanguage(data.language);
                if (data.aiAnalysis) setAiAnalysis(data.aiAnalysis);
              }
            } catch (error) {
              console.log('No saved data');
            }
          }, []);

          useEffect(() => {
            try {
              sessionStorage.setItem('insuranceAIData', JSON.stringify({
                userInfo, policies, language, aiAnalysis
              }));
            } catch (error) {
              console.log('Error saving');
            }
          }, [userInfo, policies, language, aiAnalysis]);

          const translations = {
            en: {
              appTitle: "AI Insurance Assistant",
              dashboard: "Dashboard", profile: "My Profile", policies: "My Policies", analysis: "AI Analysis",
              firstName: "First Name", lastName: "Last Name", dateOfBirth: "Date of Birth",
              nationality: "Nationality", occupation: "Occupation", dependents: "Number of Dependents",
              healthConditions: "Health Conditions (optional)", saveProfile: "Save Profile",
              addPolicy: "Add Policy", uploadFile: "Upload File", policyName: "Policy Name",
              provider: "Provider", premium: "Annual Premium (â‚¬)", excess: "Excess (â‚¬)",
              benefits: "Benefits (comma separated)", exclusions: "Exclusions (comma separated)",
              analyzeWithAI: "Analyze Coverage with AI", analyzing: "AI is analyzing your coverage...",
              noPolicies: "No policies added yet", addFirstPolicy: "Add your first policy to get started",
              welcomeBack: "Welcome back", totalPolicies: "Total Policies", totalPremium: "Total Annual Premium",
              lastAnalysis: "Last Analysis", runAnalysis: "Run New Analysis", gaps: "Coverage Gaps",
              overlaps: "Coverage Overlaps", recommendations: "Recommendations",
              clearData: "Clear All Data", age: "Age", manualEntry: "Manual Entry",
              cancel: "Cancel", save: "Save", delete: "Delete"
            },
            gr: {
              appTitle: "Î’Î¿Î·Î¸ÏŒÏ‚ Î‘ÏƒÏ†Î¬Î»Î¹ÏƒÎ·Ï‚ Î¼Îµ AI",
              dashboard: "Î Î¯Î½Î±ÎºÎ±Ï‚", profile: "Î¤Î¿ Î ÏÎ¿Ï†Î¯Î» ÎœÎ¿Ï…", policies: "ÎŸÎ¹ Î Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚ ÎœÎ¿Ï…", analysis: "Î‘Î½Î¬Î»Ï…ÏƒÎ· AI",
              firstName: "ÎŒÎ½Î¿Î¼Î±", lastName: "Î•Ï€ÏŽÎ½Ï…Î¼Î¿", dateOfBirth: "Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î“Î­Î½Î½Î·ÏƒÎ·Ï‚",
              nationality: "Î•Î¸Î½Î¹ÎºÏŒÏ„Î·Ï„Î±", occupation: "Î•Ï€Î¬Î³Î³ÎµÎ»Î¼Î±", dependents: "Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ Î•Î¾Î±ÏÏ„ÏŽÎ¼ÎµÎ½Ï‰Î½",
              healthConditions: "Î ÏÎ¿Î²Î»Î®Î¼Î±Ï„Î± Î¥Î³ÎµÎ¯Î±Ï‚", saveProfile: "Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î ÏÎ¿Ï†Î¯Î»",
              addPolicy: "Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚", uploadFile: "ÎœÎµÏ„Î±Ï†ÏŒÏÏ„Ï‰ÏƒÎ· Î‘ÏÏ‡ÎµÎ¯Î¿Ï…", policyName: "ÎŒÎ½Î¿Î¼Î± Î Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚",
              provider: "Î Î¬ÏÎ¿Ï‡Î¿Ï‚", premium: "Î•Ï„Î®ÏƒÎ¹Î¿ Î‘ÏƒÏ†Î¬Î»Î¹ÏƒÏ„ÏÎ¿ (â‚¬)", excess: "Î‘Ï€Î±Î»Î»Î±Î³Î® (â‚¬)",
              benefits: "Î Î±ÏÎ¿Ï‡Î­Ï‚", exclusions: "Î•Î¾Î±Î¹ÏÎ­ÏƒÎµÎ¹Ï‚",
              analyzeWithAI: "Î‘Î½Î¬Î»Ï…ÏƒÎ· Î¼Îµ AI", analyzing: "Î¤Î¿ AI Î±Î½Î±Î»ÏÎµÎ¹...",
              noPolicies: "Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚", addFirstPolicy: "Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï„Î·Î½ Ï€ÏÏŽÏ„Î· Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®",
              welcomeBack: "ÎšÎ±Î»ÏŽÏ‚ Î®ÏÎ¸Î±Ï„Îµ", totalPolicies: "Î£ÏÎ½Î¿Î»Î¿ Î Î¿Î»Î¹Ï„Î¹ÎºÏŽÎ½", totalPremium: "Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ Î‘ÏƒÏ†Î¬Î»Î¹ÏƒÏ„ÏÎ¿",
              lastAnalysis: "Î¤ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± Î‘Î½Î¬Î»Ï…ÏƒÎ·", runAnalysis: "ÎÎ­Î± Î‘Î½Î¬Î»Ï…ÏƒÎ·", gaps: "ÎšÎµÎ½Î¬ ÎšÎ¬Î»Ï…ÏˆÎ·Ï‚",
              overlaps: "Î•Ï€Î¹ÎºÎ±Î»ÏÏˆÎµÎ¹Ï‚", recommendations: "Î£Ï…ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚",
              clearData: "Î”Î¹Î±Î³ÏÎ±Ï†Î®", age: "Î—Î»Î¹ÎºÎ¯Î±", manualEntry: "Î§ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î· Î•Î¹ÏƒÎ±Î³Ï‰Î³Î®",
              cancel: "Î‘ÎºÏÏÏ‰ÏƒÎ·", save: "Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·", delete: "Î”Î¹Î±Î³ÏÎ±Ï†Î®"
            }
          };

          const t = translations[language];

          const calculateAge = (dob) => {
            if (!dob) return null;
            const today = new Date();
            const birthDate = new Date(dob);
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
              age--;
            }
            return age;
          };

          const analyzeWithAI = async () => {
            if (policies.length === 0) {
              alert(language === 'en' ? 'Please add at least one policy first' : 'Î Î±ÏÎ±ÎºÎ±Î»ÏŽ Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® Ï€ÏÏŽÏ„Î±');
              return;
            }

            setIsAnalyzing(true);
            setActiveTab('analysis');

            const age = calculateAge(userInfo.dateOfBirth);
            const profileContext = `
User Profile:
- Name: ${userInfo.firstName} ${userInfo.lastName}
- Age: ${age || 'Not provided'}
- Occupation: ${userInfo.occupation || 'Not provided'}
- Dependents: ${userInfo.dependents}
- Health Conditions: ${userInfo.healthConditions || 'None'}
- Nationality: ${userInfo.nationality || 'Not provided'}

Current Insurance Policies:
${policies.map((p, i) => `
Policy ${i + 1}: ${p.policyName}
- Provider: ${p.provider}
- Annual Premium: â‚¬${p.premium}
- Excess: â‚¬${p.excess}
- Benefits: ${p.benefits}
- Exclusions: ${p.exclusions}
`).join('\n')}`;

            const prompt = `You are an expert insurance analyst. Analyze this insurance portfolio and provide a comprehensive assessment in JSON format.

${profileContext}

Respond as a valid JSON object with this EXACT structure (all text in ${language === 'en' ? 'English' : 'Greek'}):

{
  "overallScore": <number 0-100>,
  "summary": "<2-3 sentence overview>",
  "coverageGaps": [
    {
      "severity": "<critical|high|medium|low>",
      "category": "<gap category>",
      "description": "<detailed description>",
      "impact": "<why this matters>",
      "recommendation": "<what to do>"
    }
  ],
  "coverageOverlaps": [
    {
      "type": "<overlap type>",
      "policies": ["<policy names>"],
      "description": "<what's overlapping>",
      "wastedCost": <euros>,
      "recommendation": "<suggestion>"
    }
  ],
  "recommendations": [
    {
      "priority": "<high|medium|low>",
      "action": "<action title>",
      "description": "<detailed explanation>",
      "estimatedCost": "<cost range>",
      "timeline": "<when to do this>"
    }
  ],
  "strengths": ["<list of good things>"]
}

IMPORTANT: Respond ONLY with valid JSON. No other text. Consider age, occupation, and dependents.`;

            try {
              const response = await fetch("https://api.anthropic.com/v1/messages", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  model: "claude-sonnet-4-20250514",
                  max_tokens: 4000,
                  messages: [{ role: "user", content: prompt }]
                })
              });

              if (!response.ok) throw new Error(`API failed: ${response.status}`);

              const data = await response.json();
              let responseText = data.content[0].text;
              responseText = responseText.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();
              
              const analysis = JSON.parse(responseText);
              setAiAnalysis(analysis);
              
              setSaveMessage(language === 'en' ? 'Analysis complete!' : 'Î‘Î½Î¬Î»Ï…ÏƒÎ· Î¿Î»Î¿ÎºÎ»Î·ÏÏŽÎ¸Î·ÎºÎµ!');
              setTimeout(() => setSaveMessage(''), 3000);
            } catch (error) {
              console.error('AI Error:', error);
              alert(language === 'en' ? 'Error analyzing coverage. Try again.' : 'Î£Ï†Î¬Î»Î¼Î± Î±Î½Î¬Î»Ï…ÏƒÎ·Ï‚.');
            } finally {
              setIsAnalyzing(false);
            }
          };

          const handleFileUpload = async (event) => {
            const file = event.target.files[0];
            if (!file) return;

            try {
              const text = await file.text();
              let parsedPolicies;

              if (file.name.endsWith('.json')) {
                parsedPolicies = JSON.parse(text);
              } else if (file.name.endsWith('.csv')) {
                const lines = text.split('\n');
                const headers = lines[0].split(',').map(h => h.trim());
                parsedPolicies = lines.slice(1).filter(line => line.trim()).map(line => {
                  const values = line.split(',').map(v => v.trim());
                  const policy = {};
                  headers.forEach((header, idx) => {
                    policy[header] = values[idx];
                  });
                  return policy;
                });
              }

              setPolicies(prev => [...prev, ...(Array.isArray(parsedPolicies) ? parsedPolicies : [parsedPolicies])]);
              setSaveMessage(language === 'en' ? 'Policies uploaded!' : 'ÎœÎµÏ„Î±Ï†Î¿ÏÏ„ÏŽÎ¸Î·ÎºÎ±Î½!');
              setTimeout(() => setSaveMessage(''), 2000);
            } catch (error) {
              alert(language === 'en' ? 'Error reading file' : 'Î£Ï†Î¬Î»Î¼Î± Î±ÏÏ‡ÎµÎ¯Î¿Ï…');
            }
          };

          const addManualPolicy = () => {
            if (!newPolicy.policyName || !newPolicy.provider) {
              alert(language === 'en' ? 'Please fill required fields' : 'Î£Ï…Î¼Ï€Î»Î·ÏÏŽÏƒÏ„Îµ Ï„Î± Ï€ÎµÎ´Î¯Î±');
              return;
            }
            setPolicies([...policies, {
              ...newPolicy,
              premium: parseFloat(newPolicy.premium) || 0,
              excess: parseFloat(newPolicy.excess) || 0
            }]);
            setNewPolicy({ policyName: '', provider: '', premium: '', excess: '', benefits: '', exclusions: '' });
            setShowManualEntry(false);
          };

          const deletePolicy = (index) => {
            if (confirm(language === 'en' ? 'Delete this policy?' : 'Î”Î¹Î±Î³ÏÎ±Ï†Î®;')) {
              setPolicies(policies.filter((_, i) => i !== index));
            }
          };

          const getSeverityColor = (severity) => {
            const colors = {
              critical: 'bg-red-100 border-red-500 text-red-900',
              high: 'bg-orange-100 border-orange-500 text-orange-900',
              medium: 'bg-yellow-100 border-yellow-500 text-yellow-900',
              low: 'bg-blue-100 border-blue-500 text-blue-900'
            };
            return colors[severity] || colors.medium;
          };

          const getPriorityBadge = (priority) => {
            const badges = {
              high: 'bg-red-500 text-white',
              medium: 'bg-yellow-500 text-white',
              low: 'bg-green-500 text-white'
            };
            return badges[priority] || badges.medium;
          };

          const renderDashboard = () => {
            const totalPremium = policies.reduce((sum, p) => sum + (parseFloat(p.premium) || 0), 0);
            const age = calculateAge(userInfo.dateOfBirth);

            return (
              <div className="space-y-6">
                <div className="bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg p-6">
                  <h2 className="text-2xl font-bold mb-2">
                    {t.welcomeBack}, {userInfo.firstName || 'User'}!
                  </h2>
                  {age && <p className="text-blue-100">{t.age}: {age}</p>}
                </div>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <div className="bg-white rounded-lg p-6 border-2 border-gray-200">
                    <div className="flex items-center justify-between mb-2">
                      <h3 className="text-gray-600 text-sm">{t.totalPolicies}</h3>
                      <Shield />
                    </div>
                    <p className="text-3xl font-bold text-gray-800">{policies.length}</p>
                  </div>

                  <div className="bg-white rounded-lg p-6 border-2 border-gray-200">
                    <div className="flex items-center justify-between mb-2">
                      <h3 className="text-gray-600 text-sm">{t.totalPremium}</h3>
                      <TrendingUp />
                    </div>
                    <p className="text-3xl font-bold text-gray-800">â‚¬{totalPremium.toLocaleString()}</p>
                    <p className="text-xs text-gray-500 mt-1">â‚¬{(totalPremium/12).toFixed(0)}/month</p>
                  </div>

                  <div className="bg-white rounded-lg p-6 border-2 border-gray-200">
                    <div className="flex items-center justify-between mb-2">
                      <h3 className="text-gray-600 text-sm">{t.lastAnalysis}</h3>
                      <Brain />
                    </div>
                    <p className="text-xl font-bold text-gray-800">
                      {aiAnalysis ? 'Recent' : 'Not yet'}
                    </p>
                  </div>
                </div>

                {aiAnalysis && (
                  <div className="bg-white rounded-lg p-6 border-2 border-purple-200">
                    <h3 className="text-xl font-bold text-gray-800 mb-4">AI Coverage Score</h3>
                    <div className="flex items-center gap-4">
                      <div className="relative w-24 h-24">
                        <svg className="transform -rotate-90 w-24 h-24">
                          <circle cx="48" cy="48" r="40" stroke="#e5e7eb" strokeWidth="8" fill="none" />
                          <circle 
                            cx="48" cy="48" r="40" 
                            stroke={aiAnalysis.overallScore >= 70 ? '#10b981' : aiAnalysis.overallScore >= 50 ? '#f59e0b' : '#ef4444'}
                            strokeWidth="8" 
                            fill="none"
                            strokeDasharray={`${2 * Math.PI * 40 * aiAnalysis.overallScore / 100} ${2 * Math.PI * 40}`}
                          />
                        </svg>
                        <div className="absolute inset-0 flex items-center justify-center">
                          <span className="text-2xl font-bold">{aiAnalysis.overallScore}</span>
                        </div>
                      </div>
                      <div className="flex-1">
                        <p className="text-gray-700">{aiAnalysis.summary}</p>
                      </div>
                    </div>
                  </div>
                )}

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <button
                    onClick={() => setActiveTab('policies')}
                    className="bg-blue-600 text-white py-4 rounded-lg font-semibold hover:bg-blue-700 transition"
                  >
                    <Shield /> {t.policies}
                  </button>
                  <button
                    onClick={analyzeWithAI}
                    disabled={policies.length === 0 || isAnalyzing}
                    className="bg-purple-600 text-white py-4 rounded-lg font-semibold hover:bg-purple-700 disabled:bg-gray-300 transition"
                  >
                    {isAnalyzing ? <Loader /> : <Brain />} {isAnalyzing ? t.analyzing : t.runAnalysis}
                  </button>
                </div>
              </div>
            );
          };

          const renderProfile = () => (
            <div className="space-y-6">
              <h2 className="text-2xl font-bold text-gray-800">{t.profile}</h2>
              
              <div className="bg-white rounded-lg p-6 border-2 border-gray-200 space-y-4">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">{t.firstName}</label>
                    <input
                      type="text"
                      value={userInfo.firstName}
                      onChange={(e) => setUserInfo({...userInfo, firstName: e.target.value})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">{t.lastName}</label>
                    <input
                      type="text"
                      value={userInfo.lastName}
                      onChange={(e) => setUserInfo({...userInfo, lastName: e.target.value})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                    />
                  </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">{t.dateOfBirth}</label>
                    <input
                      type="date"
                      value={userInfo.dateOfBirth}
                      onChange={(e) => setUserInfo({...userInfo, dateOfBirth: e.target.value})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">{t.nationality}</label>
                    <input
                      type="text"
                      value={userInfo.nationality}
                      onChange={(e) => setUserInfo({...userInfo, nationality: e.target.value})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                    />
                  </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">{t.occupation}</label>
                    <input
                      type="text"
                      value={userInfo.occupation}
                      onChange={(e) => setUserInfo({...userInfo, occupation: e.target.value})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">{t.dependents}</label>
                    <input
                      type="number"
                      value={userInfo.dependents}
                      onChange={(e) => setUserInfo({...userInfo, dependents: parseInt(e.target.value) || 0})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                    />
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">{t.healthConditions}</label>
                  <textarea
                    value={userInfo.healthConditions}
                    onChange={(e) => setUserInfo({...userInfo, healthConditions: e.target.value})}
                    className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                    rows="3"
                  />
                </div>

                <button
                  onClick={() => {
                    setSaveMessage(language === 'en' ? 'Profile saved!' : 'Î‘Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ!');
                    setTimeout(() => setSaveMessage(''), 2000);
                  }}
                  className="w-full bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700"
                >
                  {t.saveProfile}
                </button>
              </div>
            </div>
          );

          const renderPolicies = () => (
            <div className="space-y-6">
              <div className="flex justify-between items-center">
                <h2 className="text-2xl font-bold text-gray-800">{t.policies}</h2>
                <div className="flex gap-2">
                  <label className="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 cursor-pointer">
                    <Upload /> {t.uploadFile}
                    <input type="file" accept=".csv,.json" onChange={handleFileUpload} className="hidden" />
                  </label>
                  <button
                    onClick={() => setShowManualEntry(true)}
                    className="bg-green-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-700"
                  >
                    <Plus /> {t.manualEntry}
                  </button>
                </div>
              </div>

              {showManualEntry && (
                <div className="bg-white rounded-lg p-6 border-2 border-green-200">
                  <h3 className="font-bold text-gray-800 mb-4">{t.addPolicy}</h3>
                  <div className="space-y-3">
                    <input
                      type="text"
                      placeholder={t.policyName}
                      value={newPolicy.policyName}
                      onChange={(e) => setNewPolicy({...newPolicy, policyName: e.target.value})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                    />
                    <input
                      type="text"
                      placeholder={t.provider}
                      value={newPolicy.provider}
                      onChange={(e) => setNewPolicy({...newPolicy, provider: e.target.value})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                    />
                    <div className="grid grid-cols-2 gap-3">
                      <input
                        type="number"
                        placeholder={t.premium}
                        value={newPolicy.premium}
                        onChange={(e) => setNewPolicy({...newPolicy, premium: e.target.value})}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                      />
                      <input
                        type="number"
                        placeholder={t.excess}
                        value={newPolicy.excess}
                        onChange={(e) => setNewPolicy({...newPolicy, excess: e.target.value})}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                      />
                    </div>
                    <textarea
                      placeholder={t.benefits}
                      value={newPolicy.benefits}
                      onChange={(e) => setNewPolicy({...newPolicy, benefits: e.target.value})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                      rows="2"
                    />
                    <textarea
                      placeholder={t.exclusions}
                      value={newPolicy.exclusions}
                      onChange={(e) => setNewPolicy({...newPolicy, exclusions: e.target.value})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                      rows="2"
                    />
                    <div className="flex gap-2">
                      <button onClick={addManualPolicy} className="flex-1 bg-green-600 text-white py-2 rounded-lg font-semibold">
                        {t.save}
                      </button>
                      <button onClick={() => setShowManualEntry(false)} className="flex-1 bg-gray-300 text-gray-800 py-2 rounded-lg font-semibold">
                        {t.cancel}
                      </button>
                    </div>
                  </div>
                </div>
              )}

              {policies.length === 0 ? (
                <div className="bg-gray-50 rounded-lg p-12 text-center">
                  <Shield />
                  <p className="text-gray-600 text-lg">{t.noPolicies}</p>
                  <p className="text-gray-500 text-sm mt-2">{t.addFirstPolicy}</p>
                </div>
              ) : (
                <div className="space-y-4">
                  {policies.map((policy, idx) => (
                    <div key={idx} className="bg-white rounded-lg p-6 border-2 border-gray-200 hover:border-purple-300 transition">
                      <div className="flex justify-between items-start mb-3">
                        <div>
                          <h3 className="text-xl font-bold text-gray-800">{policy.policyName}</h3>
                          <p className="text-gray-600">{policy.provider}</p>
                        </div>
                        <button onClick={() => deletePolicy(idx)} className="text-red-600 hover:text-red-700">
                          <Trash2 />
                        </button>
                      </div>
                      <div className="grid grid-cols-2 gap-4 text-sm">
                        <div>
                          <span className="font-medium text-gray-700">{t.premium}:</span>
                          <span className="ml-2 text-gray-900">â‚¬{policy.premium}</span>
                        </div>
                        <div>
                          <span className="font-medium text-gray-700">{t.excess}:</span>
                          <span className="ml-2 text-gray-900">â‚¬{policy.excess}</span>
                        </div>
                      </div>
                      {policy.benefits && (
                        <div className="mt-3 text-sm">
                          <span className="font-medium text-gray-700">Benefits:</span>
                          <p className="text-gray-600 mt-1">{policy.benefits}</p>
                        </div>
                      )}
                    </div>
                  ))}
                </div>
              )}
            </div>
          );

          const renderAnalysis = () => {
            if (isAnalyzing) {
              return (
                <div className="flex flex-col items-center justify-center py-20">
                  <Loader />
                  <p className="text-gray-600 text-lg mt-4">{t.analyzing}</p>
                  <p className="text-gray-500 text-sm mt-2">This may take 10-15 seconds...</p>
                </div>
              );
            }

            if (!aiAnalysis) {
              return (
                <div className="text-center py-20">
                  <Brain />
                  <p className="text-gray-600 text-lg mb-4 mt-4">No AI analysis yet</p>
                  <button
                    onClick={analyzeWithAI}
                    disabled={policies.length === 0}
                    className="bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-700 disabled:bg-gray-300"
                  >
                    {t.analyzeWithAI}
                  </button>
                </div>
              );
            }

            return (
              <div className="space-y-6">
                <div className="bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg p-6">
                  <h2 className="text-2xl font-bold mb-2">{t.analysis}</h2>
                  <p className="text-purple-100">AI-powered comprehensive coverage analysis</p>
                </div>

                <div>
                  <h3 className="text-xl font-bold text-gray-800 mb-4"><AlertTriangle /> {t.gaps}</h3>
                  {aiAnalysis.coverageGaps && aiAnalysis.coverageGaps.length > 0 ? (
                    <div className="space-y-4">
                      {aiAnalysis.coverageGaps.map((gap, idx) => (
                        <div key={idx} className={`rounded-lg p-6 border-2 ${getSeverityColor(gap.severity)}`}>
                          <div className="flex items-start justify-between mb-3">
                            <div>
                              <span className="text-xs font-bold uppercase">{gap.severity}</span>
                              <h4 className="text-lg font-bold mt-1">{gap.category}</h4>
                            </div>
                            <AlertTriangle />
                          </div>
                          <p className="mb-2">{gap.description}</p>
                          <div className="bg-white bg-opacity-50 rounded p-3 mt-3">
                            <p className="text-sm font-medium mb-1">Impact:</p>
                            <p className="text-sm">{gap.impact}</p>
                          </div>
                          <div className="bg-white bg-opacity-50 rounded p-3 mt-2">
                            <p className="text-sm font-medium mb-1">Recommendation:</p>
                            <p className="text-sm">{gap.recommendation}</p>
                          </div>
                        </div>
                      ))}
                    </div>
                  ) : (
                    <p className="text-gray-600">No significant coverage gaps detected</p>
                  )}
                </div>

                {aiAnalysis.coverageOverlaps && aiAnalysis.coverageOverlaps.length > 0 && (
                  <div>
                    <h3 className="text-xl font-bold text-gray-800 mb-4"><FileText /> {t.overlaps}</h3>
                    <div className="space-y-4">
                      {aiAnalysis.coverageOverlaps.map((overlap, idx) => (
                        <div key={idx} className="bg-orange-50 border-2 border-orange-300 rounded-lg p-6">
                          <h4 className="text-lg font-bold text-orange-900 mb-2">{overlap.type}</h4>
                          <p className="text-orange-800 mb-2">{overlap.description}</p>
                          <div className="flex items-center gap-2 text-sm text-orange-700 mb-3">
                            <span className="font-medium">Policies:</span>
                            <span>{overlap.policies.join(', ')}</span>
                          </div>
                          {overlap.wastedCost > 0 && (
                            <div className="bg-orange-100 rounded p-3 mb-2">
                              <p className="text-sm font-medium text-orange-900">
                                ðŸ’° Wasted cost: â‚¬{overlap.wastedCost}/year
                              </p>
                            </div>
                          )}
                          <div className="bg-white rounded p-3">
                            <p className="text-sm font-medium mb-1">Recommendation:</p>
                            <p className="text-sm">{overlap.recommendation}</p>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                <div>
                  <h3 className="text-xl font-bold text-gray-800 mb-4"><CheckCircle /> {t.recommendations}</h3>
                  <div className="space-y-4">
                    {aiAnalysis.recommendations.map((rec, idx) => (
                      <div key={idx} className="bg-white rounded-lg p-6 border-2 border-gray-200">
                        <div className="flex items-start justify-between mb-3">
                          <h4 className="text-lg font-bold text-gray-800">{rec.action}</h4>
                          <span className={`px-3 py-1 rounded-full text-xs font-bold ${getPriorityBadge(rec.priority)}`}>
                            {rec.priority.toUpperCase()}
                          </span>
                        </div>
                        <p className="text-gray-700 mb-3">{rec.description}</p>
                        <div className="grid grid-cols-2 gap-4 text-sm">
                          <div>
                            <span className="font-medium text-gray-600">Cost:</span>
                            <p className="text-gray-900">{rec.estimatedCost}</p>
                          </div>
                          <div>
                            <span className="font-medium text-gray-600">Timeline:</span>
                            <p className="text-gray-900">{rec.timeline}</p>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>

                {aiAnalysis.strengths && aiAnalysis.strengths.length > 0 && (
                  <div className="bg-green-50 border-2 border-green-300 rounded-lg p-6">
                    <h3 className="text-xl font-bold text-green-900 mb-4"><CheckCircle /> Your Coverage Strengths</h3>
                    <ul className="space-y-2">
                      {aiAnalysis.strengths.map((strength, idx) => (
                        <li key={idx} className="flex items-start gap-2 text-green-800">
                          <CheckCircle />
                          <span>{strength}</span>
                        </li>
                      ))}
                    </ul>
                  </div>
                )}
              </div>
            );
          };

          return (
            <div className="min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-50 p-4">
              <div className="max-w-6xl mx-auto">
                <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                  <div className="flex justify-between items-center">
                    <div className="flex items-center gap-3">
                      <div className="bg-purple-600 p-2 rounded-lg">
                        <Brain />
                      </div>
                      <div>
                        <h1 className="text-2xl font-bold text-gray-800">{t.appTitle}</h1>
                        {saveMessage && (
                          <div className="flex items-center gap-2 text-green-600 text-sm">
                            <Save />
                            <span>{saveMessage}</span>
                          </div>
                        )}
                      </div>
                    </div>
                    <div className="flex gap-2">
                      <button
                        onClick={() => setLanguage('en')}
                        className={`px-4 py-2 rounded-lg font-semibold ${
                          language === 'en' ? 'bg-purple-600 text-white' : 'bg-gray-200 text-gray-700'
                        }`}
                      >
                        EN
                      </button>
                      <button
                        onClick={() => setLanguage('gr')}
                        className={`px-4 py-2 rounded-lg font-semibold ${
                          language === 'gr' ? 'bg-purple-600 text-white' : 'bg-gray-200 text-gray-700'
                        }`}
                      >
                        Î•Î›
                      </button>
                      <button
                        onClick={() => {
                          if (confirm(language === 'en' ? 'Clear all data?' : 'Î”Î¹Î±Î³ÏÎ±Ï†Î®;')) {
                            sessionStorage.removeItem('insuranceAIData');
                            window.location.reload();
                          }
                        }}
                        className="px-3 py-2 rounded-lg bg-red-100 text-red-600 hover:bg-red-200"
                      >
                        <Trash2 />
                      </button>
                    </div>
                  </div>
                </div>

                <div className="bg-white rounded-lg shadow-lg p-2 mb-6 flex gap-2 overflow-x-auto">
                  {[
                    { id: 'dashboard', label: t.dashboard },
                    { id: 'profile', label: t.profile },
                    { id: 'policies', label: t.policies },
                    { id: 'analysis', label: t.analysis }
                  ].map(tab => (
                    <button
                      key={tab.id}
                      onClick={() => setActiveTab(tab.id)}
                      className={`px-4 py-2 rounded-lg font-semibold whitespace-nowrap ${
                        activeTab === tab.id
                          ? 'bg-purple-600 text-white'
                          : 'text-gray-700 hover:bg-gray-100'
                      }`}
                    >
                      {tab.label}
                    </button>
                  ))}
                </div>

                <div className="bg-white rounded-lg shadow-lg p-6">
                  {activeTab === 'dashboard' && renderDashboard()}
                  {activeTab === 'profile' && renderProfile()}
                  {activeTab === 'policies' && renderPolicies()}
                  {activeTab === 'analysis' && renderAnalysis()}
                </div>

                <footer className="text-center mt-6 text-gray-600 text-sm">
                  <p>Â© 2025 AI Insurance Assistant | Powered by Claude AI</p>
                </footer>
              </div>
            </div>
          );
        };
        
        ReactDOM.render(<InsuranceAIAssistant />, document.getElementById('root'));
    </script>
</body>
</html>
